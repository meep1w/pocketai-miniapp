/* ===== THEME VARS (default: dark) ===== */
:root{
    --bg:#0f0f12;
    --card:#141419;
    --text:#ffffff;
    --muted:rgba(255,255,255,0.65);
    --stroke:rgba(255,255,255,0.10);
    --shadow:0 4px 18px rgba(0,0,0,0.35);
    --accent:#2ea7ff;
    --accent-pressed:#2196f3;
}

html[data-theme="dark"]{
    --bg:#0f0f12;
    --card:#141419;
    --text:#ffffff;
    --muted:rgba(255,255,255,0.65);
    --stroke:rgba(255,255,255,0.10);
    --shadow:0 4px 18px rgba(0,0,0,0.35);
}

html[data-theme="light"]{
    --bg:#f4f5f9;
    --card:#ffffff;
    --text:#0f0f12;
    --muted:rgba(0,0,0,0.65);
    --stroke:rgba(0,0,0,0.10);
    --shadow:0 6px 18px rgba(0,0,0,0.08);
}

/* ===== BASE ===== */
*{ box-sizing: border-box }
html,body{ height:100% }
body{
    margin:0;
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:var(--bg);
    color:var(--text);
}

/* ===== HEADER ===== */
.app-header{
    position:sticky; top:0; z-index:1000;
    display:flex; align-items:center; justify-content:space-between;
    padding: calc(env(safe-area-inset-top,0) + 10px) 14px 10px;
    background:var(--card);
    border-bottom:1px solid var(--stroke);
    box-shadow: var(--shadow);
}
.header-left,.header-right{ display:flex; align-items:center; gap:8px }
.header-logo{ flex:1; display:flex; justify-content:center; min-width:0 }
.header-logo img{ height:28px; max-width:160px; object-fit:contain }

.icon-btn{
    display:inline-flex; align-items:center; justify-content:center;
    width:40px; height:40px; border:none; background:transparent; color:inherit;
    border-radius:12px; cursor:pointer; -webkit-tap-highlight-color:transparent;
    transition: background .15s ease, opacity .15s ease;
}
.icon-btn:hover{ background: rgba(127,127,127,0.06) }
html[data-theme="light"] .icon-btn:hover{ background: rgba(0,0,0,0.05) }
.icon-btn:active{ opacity:.7 }

/* mask icons (auto color by theme) */
.icon{
    display:inline-block; width:22px; height:22px;
    background-color: var(--text);
    -webkit-mask-position:center; -webkit-mask-repeat:no-repeat; -webkit-mask-size:contain;
    mask-position:center; mask-repeat:no-repeat; mask-size:contain;
}
.icon-burger{ -webkit-mask-image:url("../img/burger.svg"); mask-image:url("../img/burger.svg"); }
.icon-crown{  -webkit-mask-image:url("../img/base.svg");   mask-image:url("../img/base.svg"); }
.icon-stats{  -webkit-mask-image:url("../img/icons/stats.svg");  mask-image:url("../img/icons/stats.svg"); }
.icon-globe{  -webkit-mask-image:url("../img/icons/globe.svg");  mask-image:url("../img/icons/globe.svg"); }
.icon-theme{  -webkit-mask-image:url("../img/icons/theme.svg");  mask-image:url("../img/icons/theme.svg"); }
.icon-moon {  -webkit-mask-image:url("../img/icons/moon.svg");   mask-image:url("../img/icons/moon.svg"); }
.icon-auto {  -webkit-mask-image:url("../img/icons/auto.svg");   mask-image:url("../img/icons/auto.svg"); }
.icon-sun  {  -webkit-mask-image:url("../img/icons/sun.svg");    mask-image:url("../img/icons/sun.svg"); }
.icon-search{ -webkit-mask-image:url("../img/icons/search.svg"); mask-image:url("../img/icons/search.svg"); }
.icon-signal{ -webkit-mask-image:url("../img/icons/signal.svg"); mask-image:url("../img/icons/signal.svg"); width:18px; height:18px }

/* ===== SIDEBAR (open from left) ===== */
.sidebar{
    position:fixed; inset:0 auto 0 0; /* left */
    width:86%; max-width:360px;
    background:var(--card);
    border-right:1px solid var(--stroke);
    transform: translateX(-100%);
    transition: transform .28s ease;
    z-index:1200; display:flex; flex-direction:column;
    padding-bottom: env(safe-area-inset-bottom,0);
}
.sidebar.open{ transform: translateX(0) }

.sidebar__head{
    display:flex; align-items:center; justify-content:space-between;
    padding: calc(env(safe-area-inset-top,0) + 12px) 14px 10px;
    border-bottom:1px solid var(--stroke);
}
.sidebar__title{ font-weight:700 }

.sidebar__nav{ padding:12px 8px; display:flex; flex-direction:column; gap:6px }
.sidebar__item{
    display:flex; align-items:center; gap:10px;
    padding:12px 12px; border-radius:14px;
    border:1px solid var(--stroke);
    background:transparent; color:var(--text); text-align:left;
}
.sidebar__item:active{ background:rgba(127,127,127,0.06) }
.sidebar__icon{ width:22px; display:inline-flex; justify-content:center }

/* ===== MODAL (фикс центр, поверх всего) ===== */
.modal{ position:fixed; inset:0; display:none; z-index:3000 }
.modal.open{ display:block }
.modal__backdrop{ position:absolute; inset:0; background:rgba(0,0,0,0.45); backdrop-filter: blur(2px) }
.modal__dialog{
    position:fixed; left:50%; top:50%; transform: translate(-50%, -50%);
    width:min(92%, 420px); max-height:80vh; overflow:auto;
    background:var(--card); color:var(--text);
    border:1px solid var(--stroke); border-radius:18px; box-shadow: var(--shadow); padding:16px;
}
.modal__title{ text-align:center; margin:6px 0 12px }
.option-list{ display:flex; flex-direction:column; gap:10px; margin: 4px 0 14px }
.option-item{
    display:flex; align-items:center; gap:10px; width:100%; padding:14px 14px;
    border-radius:14px; border:1px solid var(--stroke); background:#1b1b1f; color:var(--text);
}
html[data-theme="light"] .option-item{ background:#f1f2f6 }
.option-item .icon{ background-color: var(--text); }
.modal__close{
    display:block; width:80%; max-width:240px; margin:20px auto 6px; padding:12px 16px;
    border-radius:999px; border:none; cursor:pointer;
    background:var(--accent); color:#fff; font-weight:700; font-size:15px;
}
.modal__close:hover{ background:var(--accent-pressed) }

/* Premium modal */
.modal__dialog--premium{ width:min(92%, 440px); padding:18px 18px 16px }
.premium-icons{ display:flex; align-items:center; justify-content:center; gap:14px; margin-top:6px; margin-bottom:8px }
.premium-icon{ width:56px; height:56px; object-fit:contain; filter: drop-shadow(0 2px 8px rgba(0,0,0,0.25)) }
.premium-arrow{ width:28px; height:28px; opacity:.8 }
.premium-sub{ text-align:center; color: var(--muted); margin: 8px 6px 10px }
.premium-list{ list-style:none; padding:0; margin: 6px 0 16px; display:flex; flex-direction:column; gap:10px }
.premium-list li{
    display:flex; align-items:flex-start; gap:10px; padding:10px 12px;
    border:1px solid var(--stroke); border-radius:12px; background: rgba(127,127,127,0.06)
}
html[data-theme="light"] .premium-list li{ background: rgba(0,0,0,0.04) }

/* Instruments modal */
.modal__dialog--instruments{ width:min(96%, 860px); padding:16px }
.instr-search{ position:relative; margin:8px 0 12px }
.instr-search__input{
    width:100%; padding:12px 42px 12px 14px; border-radius:12px; border:1px solid var(--stroke);
    background:#1b1b1f; color:var(--text); font-size:15px; outline:none;
}
html[data-theme="light"] .instr-search__input{ background:#f1f2f6 }
.instr-search__icon{ position:absolute; right:12px; top:50%; transform:translateY(-50%); width:20px; height:20px }

.instr-body{ display:grid; grid-template-columns:200px 1fr; gap:12px; min-height:320px }
@media (max-width:640px){ .instr-body{ grid-template-columns:1fr } }
.instr-cats{ border-right:1px solid var(--stroke); padding-right:12px }
@media (max-width:640px){ .instr-cats{ border-right:none; border-bottom:1px solid var(--stroke); padding-bottom:8px; margin-bottom:8px } }
.instr-cats__title{ font-weight:700; font-size:12px; letter-spacing:.06em; color:var(--muted); margin-bottom:10px }
.instr-cat{
    display:block; width:100%; text-align:left; padding:10px 12px; margin-bottom:6px;
    border-radius:12px; border:1px solid var(--stroke); background:transparent; color:var(--text);
}
.instr-cat.is-active{ background: rgba(127,127,127,0.08); box-shadow: inset 0 0 0 2px rgba(127,127,127,0.18) }
.instr-list{ display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:8px; align-content:start }
@media (max-width:500px){ .instr-list{ grid-template-columns:1fr } }
.instr-item{
    display:flex; align-items:center; justify-content:center; padding:12px; border-radius:12px; border:1px solid var(--stroke);
    background:#1b1b1f; color:var(--text); text-align:center; min-height:44px;
}
html[data-theme="light"] .instr-item{ background:#f3f4f7 }
.instr-item:active{ transform:scale(0.995) }

/* Timeframe modal */
.modal__dialog--time{ width:min(92%, 420px); padding:16px }
.tf-list{ display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px; margin:10px 0 16px }
@media (max-width:380px){ .tf-list{ grid-template-columns: repeat(2, minmax(0,1fr)) } }
.tf-item{
    display:flex; align-items:center; justify-content:center; padding:12px 0; border-radius:12px;
    border:1px solid var(--stroke); background:#1b1b1f; color:var(--text); font-weight:700; letter-spacing:.3px; user-select:none;
}
html[data-theme="light"] .tf-item{ background:#f1f2f6 }
.tf-item:active{ transform:scale(0.98) }
.tf-item.is-active{ outline: 2px solid rgba(46,167,255,.6); box-shadow: 0 0 0 4px rgba(46,167,255,.15) }

/* Expiration field (badge inside) */
#field-expiration .ui-field__box{ display:flex; align-items:center; justify-content:space-between; gap:10px }
#field-expiration .ui-field__placeholder{ flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
.ui-badge{ display:inline-flex; align-items:center; justify-content:center; padding:6px 10px; border-radius:999px; font-size:12px; font-weight:600; line-height:1; white-space:nowrap }
.ui-badge[hidden]{ display:none !important; }
.ui-badge--warn{ background: rgba(255,193,7,.18); color:#ffcf5a; border:1px solid rgba(255,193,7,.35) }
html[data-theme="light"] .ui-badge--warn{ background: rgba(255,193,7,.15); color:#8a6a00; border-color: rgba(255,193,7,.35) }

/* Expiration modal */
.modal__dialog--expire{ width:min(92%, 460px); padding:16px }
#expireModal .exp-list{ display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px; margin:10px 0 16px }
@media (max-width:380px){ #expireModal .exp-list{ grid-template-columns: repeat(2, minmax(0,1fr)) } }
#expireModal .exp-item{
    display:flex; align-items:center; justify-content:center; padding:12px 0; border-radius:12px; border:1px solid var(--stroke);
    background:#1b1b1f; color:var(--text); font-weight:700; letter-spacing:.3px; user-select:none; transition:transform .06s ease;
}
html[data-theme="light"] #expireModal .exp-item{ background:#f1f2f6 }
#expireModal .exp-item:active{ transform:scale(0.98) }
#expireModal .exp-item.is-active{ outline: 2px solid rgba(46,167,255,.6); box-shadow: 0 0 0 4px rgba(46,167,255,.15) }

/* ===== CONTENT ===== */
.app-main{ padding:16px }
.select-blocks{ display:flex; flex-direction:column; gap:18px; margin-top:16px; padding:0 16px }
.ui-field{ display:flex; flex-direction:column; gap:8px; cursor:pointer; -webkit-tap-highlight-color:transparent }
.ui-field__label{ font-size:14px; line-height:1.2; color:var(--muted) }
.ui-field__box{
    background:#1b1b1f; border:1px solid var(--stroke); border-radius:14px; padding:14px 16px; min-height:48px;
    display:flex; align-items:center; transition:border-color .2s ease, box-shadow .2s ease, background .2s ease, transform .02s ease;
}
html[data-theme="light"] .ui-field__box{ background:#e1e1e1 }
.ui-field:active .ui-field__box{ transform:scale(0.996) }
.ui-field:focus-within .ui-field__box{ border-color: rgba(127,127,127,0.25); box-shadow:0 0 0 3px rgba(127,127,127,0.08) }
.ui-field__placeholder{ opacity:.75; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; width:100%; font-size:15px }

/* Actions + button */
.actions{ padding: 16px; padding-top: 12px; }
.btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; border:none; cursor:pointer; user-select:none; -webkit-tap-highlight-color:transparent; border-radius:14px; font-weight:700; text-align:center; transition: background .18s ease, opacity .18s ease, transform .02s ease }
.btn-lg{ width:100%; padding:14px 18px; font-size:15px }
.btn-primary{ background: var(--accent); color:#fff }
.btn-primary:hover{ background: var(--accent-pressed) }
.btn-primary:active{ transform: scale(0.995) }
.btn[disabled]{ opacity:.55; cursor:not-allowed }

/* Signal card */
.signal-card{ margin: 8px 16px 24px; background: var(--card); border: 1px solid var(--stroke); border-radius: 18px; overflow: hidden; box-shadow: var(--shadow) }
.signal-head{ display:flex; align-items:center; justify-content:space-between; padding: 12px 14px; border-bottom: 1px solid var(--stroke) }
.signal-title{ display:flex; align-items:center; gap:8px; font-weight:800 }
.signal-model{ opacity:.8; font-size:13px }
.signal-body{ padding: 16px; display:flex; flex-direction:column; align-items:center; min-height:120px }
.signal-idle{ width:100%; opacity:.8 }
.signal-loading{ display:flex; flex-direction:column; align-items:center; gap:10px }
.signal-loader{ width:64px; height:64px; object-fit:contain }
.signal-loading-text{ opacity:.85 }
.signal-inst{ font-size:18px; font-weight:800; text-align:center; margin-bottom:6px }
.signal-action{ font-size:20px; font-weight:900; text-align:center; margin-bottom:8px }
.signal-action.buy{ color:#35d07f }
.signal-action.sell{ color:#ff6464 }
.signal-meta{ text-align:center; display:flex; flex-direction:column; gap:4px; margin-bottom:6px }
.signal-received{ opacity:.6; font-size:12px }
.signal-warn{ margin-top:8px; padding:8px 12px; border-radius:12px; background: rgba(255,193,7,.15); border:1px solid rgba(255,193,7,.35); color:#ffcf5a }
html[data-theme="light"] .signal-warn{ color:#8a6a00 }

/* показываем только нужный state карточки сигнала */
.signal-body > * { display: none; }
.signal-card[data-state="idle"]    #signalIdle    { display: block; }
.signal-card[data-state="loading"] #signalLoading { display: flex; }
.signal-card[data-state="result"]  #signalResult  { display: block; }

/* === Typography cleanup: ровные веса по всему приложению === */
:root{
    --fw-regular: 400;
    --fw-medium: 500;
    --fw-semibold: 600;
    --fw-bold: 700;
}

/* базовые улучшения рендера */
body{
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-weight: var(--fw-regular);
    letter-spacing: .01em;
}

/* Лейблы полей чуть сильнее, но не жирные */
.ui-field__label{ font-weight: var(--fw-semibold); }

/* Заголовки модалок и секций */
.sidebar__title,
.modal__title{ font-weight: var(--fw-bold); }

/* Кнопки */
.btn{ font-weight: var(--fw-semibold); }

/* Карточка сигнала — убираем «супер жирность» */
.signal-head .signal-title{ font-weight: var(--fw-semibold); }    /* было 800 */
.signal-body .signal-inst{  font-weight: var(--fw-bold); }        /* название инструмента */
.signal-body .signal-action{font-weight: var(--fw-bold); }

.reset-wrap{
    padding: 0 16px 24px;
    text-align: center;
}
.btn-link{
    background: transparent;
    border: none;
    color: var(--accent);
    font-weight: var(--fw-semibold, 600);
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 12px;
}
.btn-link:active{ opacity:.8 }

/* Stats modal */
.modal__dialog--stats{ width:min(92%, 420px); padding:18px }
.stats-rows{ margin:4px 6px 12px }
.stats-row{
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 6px;
}
.stats-row .key{ color:var(--muted) }
.stats-row .val{ font-weight: var(--fw-semibold, 600) }

/* золотая иконка тарифа-короны в хедере, когда премиум */
.tier-img{ width:22px; height:22px; display:block; object-fit:contain }

/* Language modal */
.modal__dialog--lang{
    width:min(92%, 420px);
    padding:18px;
}
.lang-grid{
    display:grid;
    grid-template-columns: repeat(2, minmax(0,1fr));
    gap:10px;
    margin:8px 0 14px;
}
.lang-opt{
    display:flex; align-items:center; gap:10px;
    padding:14px;
    border-radius:14px;
    border:1px solid var(--stroke);
    background:#1b1b1f;
    color:var(--text);
    transition:transform .06s ease;
}
.lang-opt:active{ transform:scale(0.99) }
html[data-theme="light"] .lang-opt{ background:#f1f2f6 }
.lang-flag{
    width:24px; height:24px; border-radius:999px;
    box-shadow: 0 1px 2px rgba(0,0,0,.2);
}
.lang-opt.is-active{
    outline:2px solid rgba(46,167,255,.6);
    box-shadow:0 0 0 4px rgba(46,167,255,.15);
}

/* ==== Top banner (tier upgrade) ==== */
.top-banner{
    position: fixed;
    left: 50%;
    top: calc(env(safe-area-inset-top, 0px) + 10px);
    transform: translate(-50%, -18px);
    opacity: 0;
    transition: transform .28s ease, opacity .28s ease;
    z-index: 5000;
    background: var(--card);
    color: var(--text);
    border: 1px solid var(--stroke);
    border-radius: 14px;
    box-shadow: var(--shadow);
    padding: 10px 14px;
    display: flex; align-items: center; gap: 10px;
    pointer-events: none;          /* не перехватывает клики */
}
.top-banner.show{
    transform: translate(-50%, 0);
    opacity: 1;
}
.top-banner__icon{
    width: 22px; height: 22px; object-fit: contain;
    filter: drop-shadow(0 1px 2px rgba(0,0,0,.25));
}
.top-banner__text{ display:flex; flex-direction:column; }
.top-banner__title{ font-weight: var(--fw-bold, 700); }
.top-banner__sub{ font-size:13px; opacity:.85 }
